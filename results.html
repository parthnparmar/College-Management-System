<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Results - College Management</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      background-image: url('https://images.unsplash.com/photo-1581091215367-59ab6c4e9af1');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(3px);
    }
    .container {
      max-width: 1100px;
      width: 100%;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: 40px;
      animation: fadeIn 1s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: scale(0.95);}
      to {opacity: 1; transform: scale(1);}
    }
    h1 {
      text-align: center;
      color: #fff;
      margin-bottom: 30px;
      font-size: 2.5rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .filters, .add-form {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 25px;
    }
    select, input[type="text"], input[type="number"] {
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(3px);
      outline: none;
      transition: 0.3s;
      width: 160px;
    }
    select:focus, input:focus {
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    #downloadBtn, #addBtn, #downloadPdfBtn {
      padding: 12px 25px;
      background: linear-gradient(135deg, #2e86de, #6a11cb);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s, transform 0.2s;
      margin: 5px;
    }
    #downloadBtn:hover, #addBtn:hover, #downloadPdfBtn:hover {
      background: linear-gradient(135deg, #6a11cb, #2e86de);
      transform: scale(1.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: rgba(255,255,255,0.7);
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 14px;
      border: 1px solid rgba(0,0,0,0.1);
      text-align: center;
      font-size: 16px;
    }
    th {
      background-color: #2c3e50;
      color: white;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    td {
      background: rgba(255,255,255,0.8);
    }
    .pass {
      color: green;
      font-weight: bold;
    }
    .fail {
      color: red;
      font-weight: bold;
    }
    .add-form input {
      width: 140px;
    }
    @media (max-width: 768px) {
      .filters, .add-form {
        flex-direction: column;
        align-items: center;
      }
      .add-form input, select, input {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéì Student Results</h1>

    <div class="filters">
      <select id="departmentSelect">
        <option value="Computer Science">Computer Science</option>
        <option value="Digital Electronics">Digital Electronics</option>
        <option value="Electrical Engineering">Electrical Engineering</option>
        <option value="Mechanical Engineering">Mechanical Engineering</option>
      </select>

      <select id="semesterSelect">
        <option value="1">Semester 1</option>
        <option value="2">Semester 2</option>
        <option value="3">Semester 3</option>
      </select>
    </div>

    <div class="add-form">
      <input type="text" id="rollInput" placeholder="Roll No" />
      <input type="text" id="nameInput" placeholder="Name" />
      <input type="number" id="s1Input" placeholder="Subject 1" />
      <input type="number" id="s2Input" placeholder="Subject 2" />
      <input type="number" id="s3Input" placeholder="Subject 3" />
      <button id="addBtn">‚ûï Add Marks</button>
    </div>

    <div style="text-align: center;">
      <button id="downloadBtn">‚¨áÔ∏è Download CSV</button>
      <button id="downloadPdfBtn">‚¨áÔ∏è Download PDF</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Roll No</th>
          <th>Name</th>
          <th>Subject 1</th>
          <th>Subject 2</th>
          <th>Subject 3</th>
          <th>Total</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="resultTable"></tbody>
    </table>
  </div>

  <!-- jsPDF library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- jsPDF AutoTable plugin -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

  <script>
    const resultsData = {
      "Computer Science": { 1: [], 2: [], 3: [] },
      "Digital Electronics": { 1: [], 2: [], 3: [] },
      "Electrical Engineering": { 1: [], 2: [], 3: [] },
      "Mechanical Engineering": { 1: [], 2: [], 3: [] }
    };

    // Preload some data
    resultsData["Computer Science"][1].push({ roll: "CS101", name: "Alice", s1: 78, s2: 85, s3: 92 });
    resultsData["Computer Science"][1].push({ roll: "CS102", name: "Bob", s1: 65, s2: 70, s3: 58 });

    const departmentSelect = document.getElementById("departmentSelect");
    const semesterSelect = document.getElementById("semesterSelect");
    const resultTable = document.getElementById("resultTable");

    function renderResults() {
      const dept = departmentSelect.value;
      const sem = parseInt(semesterSelect.value);
      const records = resultsData[dept][sem] || [];

      resultTable.innerHTML = "";

      records.forEach(student => {
        const total = student.s1 + student.s2 + student.s3;
        const status = (student.s1 >= 40 && student.s2 >= 40 && student.s3 >= 40) ? "Pass" : "Fail";

        const row = `
          <tr>
            <td>${student.roll}</td>
            <td>${student.name}</td>
            <td>${student.s1}</td>
            <td>${student.s2}</td>
            <td>${student.s3}</td>
            <td>${total}</td>
            <td class="${status === 'Pass' ? 'pass' : 'fail'}">${status}</td>
          </tr>
        `;
        resultTable.insertAdjacentHTML("beforeend", row);
      });
    }

    function downloadCSV() {
      const dept = departmentSelect.value;
      const sem = semesterSelect.value;
      const records = resultsData[dept][parseInt(sem)];

      let csv = `Department: ${dept}, Semester: ${sem}\n`;
      csv += "Roll No,Name,Subject 1,Subject 2,Subject 3,Total,Status\n";

      records.forEach(student => {
        const total = student.s1 + student.s2 + student.s3;
        const status = (student.s1 >= 40 && student.s2 >= 40 && student.s3 >= 40) ? "Pass" : "Fail";
        csv += `${student.roll},${student.name},${student.s1},${student.s2},${student.s3},${total},${status}\n`;
      });

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      const url = URL.createObjectURL(blob);
      link.setAttribute("href", url);
      link.setAttribute("download", `Student_Results_${dept.replaceAll(" ", "_")}_Sem${sem}.csv`);
      link.style.visibility = "hidden";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const dept = departmentSelect.value;
      const sem = semesterSelect.value;
      const records = resultsData[dept][parseInt(sem)];

      doc.setFontSize(18);
      doc.text(`Student Results - ${dept} (Semester ${sem})`, 14, 20);

      const tableColumn = ["Roll No", "Name", "Subject 1", "Subject 2", "Subject 3", "Total", "Status"];
      const tableRows = [];

      records.forEach(student => {
        const total = student.s1 + student.s2 + student.s3;
        const status = (student.s1 >= 40 && student.s2 >= 40 && student.s3 >= 40) ? "Pass" : "Fail";
        const studentData = [
          student.roll,
          student.name,
          student.s1,
          student.s2,
          student.s3,
          total,
          status
        ];
        tableRows.push(studentData);
      });

      doc.autoTable({
        head: [tableColumn],
        body: tableRows,
        startY: 30,
        styles: { halign: 'center' },
        headStyles: { fillColor: [40, 53, 80] }
      });

      doc.save(`Student_Results_${dept.replaceAll(" ", "_")}_Sem${sem}.pdf`);
    }

    function addMarks() {
      const dept = departmentSelect.value;
      const sem = parseInt(semesterSelect.value);

      const roll = document.getElementById("rollInput").value.trim();
      const name = document.getElementById("nameInput").value.trim();
      const s1 = parseInt(document.getElementById("s1Input").value);
      const s2 = parseInt(document.getElementById("s2Input").value);
      const s3 = parseInt(document.getElementById("s3Input").value);

      if (!roll || !name || isNaN(s1) || isNaN(s2) || isNaN(s3)) {
        alert("Please fill in all fields with valid values.");
        return;
      }

      const newStudent = { roll, name, s1, s2, s3 };
      resultsData[dept][sem].push(newStudent);

      document.getElementById("rollInput").value = "";
      document.getElementById("nameInput").value = "";
      document.getElementById("s1Input").value = "";
      document.getElementById("s2Input").value = "";
      document.getElementById("s3Input").value = "";

      renderResults();
    }

    departmentSelect.addEventListener("change", renderResults);
    semesterSelect.addEventListener("change", renderResults);
    document.getElementById("downloadBtn").addEventListener("click", downloadCSV);
    document.getElementById("downloadPdfBtn").addEventListener("click", downloadPDF);
    document.getElementById("addBtn").addEventListener("click", addMarks);

    // Initial render
    renderResults();
  </script>
</body>
</html>
